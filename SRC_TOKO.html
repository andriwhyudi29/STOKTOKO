<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SRC MATHARI</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>.hidden{display:none}</style>
</head>
<body class="bg-white text-gray-900">

<!-- Header -->
<header class="bg-gradient-to-r from-red-600 to-white text-center py-4 shadow-md relative">
  <button id="btnSignIn" onclick="showSignIn()" class="absolute left-2 top-2 bg-gray-800 text-white px-3 py-1 rounded">Sign In</button>
  <h1 class="text-2xl font-bold text-white drop-shadow">SRC MATHARI</h1>
</header>

<!-- Menu -->
<div class="p-4 space-y-4">
  <button id="btnTambah" onclick="checkLogin(showAddForm)" class="w-full bg-red-500 text-white py-2 rounded-lg">âž• Tambah Barang</button>
  <button id="btnKosong" onclick="checkLogin(showKosong)" class="w-full bg-gray-800 text-white py-2 rounded-lg">ðŸ“¦ Barang Kosong</button>
  <button id="btnKeranjang" onclick="checkLogin(showKeranjang)" class="w-full bg-green-600 text-white py-2 rounded-lg">ðŸ›’ Keranjang</button>
</div>

<!-- Kategori + Barang -->
<div id="kategoriList" class="p-4 space-y-2"></div>

<!-- Form Tambah Barang -->
<div id="formTambah" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-4 rounded-lg w-80">
    <h2 class="font-bold mb-2">Tambah Barang</h2>
    <input id="namaBarang" placeholder="Nama Barang" class="border w-full mb-2 p-2 rounded">
    <input id="kategoriBarang" placeholder="Kategori" class="border w-full mb-2 p-2 rounded">
    <input id="stokBarang" type="number" placeholder="Stok" class="border w-full mb-2 p-2 rounded">
    <input id="gambarBarang" type="file" accept="image/*" class="border w-full mb-2 p-2 rounded">
    <div class="flex justify-between">
      <button onclick="simpanBarang()" class="bg-red-500 text-white px-3 py-1 rounded">Simpan</button>
      <button onclick="tutupForm()" class="bg-gray-400 px-3 py-1 rounded">Batal</button>
    </div>
  </div>
</div>

<!-- Popup Aksi Barang -->
<div id="popupAksi" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-4 rounded-lg w-80 text-center">
    <h2 id="popupNama" class="font-bold mb-2"></h2>
    <img id="popupGambar" class="mx-auto mb-2 w-20 h-20 object-cover rounded">
    <p id="popupStok" class="mb-2"></p>
    <div class="grid grid-cols-2 gap-2">
      <button onclick="checkLogin(barangMasuk)" class="bg-green-500 text-white py-1 rounded">Masuk</button>
      <button onclick="checkLogin(barangKeluar)" class="bg-yellow-500 text-white py-1 rounded">Keluar</button>
      <button onclick="checkLogin(editBarang)" class="bg-blue-500 text-white py-1 rounded">Edit</button>
      <button onclick="checkLogin(hapusBarang)" class="bg-red-600 text-white py-1 rounded">Hapus</button>
    </div>
    <div class="mt-3">
      <span class="font-bold">+ Keranjang:</span>
      <div class="flex justify-around mt-1">
        <button onclick="checkLogin(()=>addToCart('pcs'))" class="bg-purple-600 text-white px-3 py-1 rounded">PCS</button>
        <button onclick="checkLogin(()=>addToCart('bal'))" class="bg-purple-600 text-white px-3 py-1 rounded">BAL</button>
        <button onclick="checkLogin(()=>addToCart('dus'))" class="bg-purple-600 text-white px-3 py-1 rounded">DUS</button>
      </div>
    </div>
    <button onclick="tutupPopup()" class="mt-3 bg-gray-400 px-3 py-1 rounded w-full">Tutup</button>
  </div>
</div>

<!-- Barang Kosong -->
<div id="halamanKosong" class="hidden p-4">
  <h2 class="font-bold mb-3">Barang Kosong</h2>
  <ul id="listKosong" class="space-y-2"></ul>
  <button onclick="tutupKosong()" class="bg-gray-400 px-3 py-1 rounded">Kembali</button>
</div>

<!-- Halaman Keranjang -->
<div id="halamanKeranjang" class="hidden p-4">
  <h2 class="font-bold mb-3">Keranjang</h2>
  <ul id="listKeranjang" class="space-y-2"></ul>
  <button onclick="checkLogin(checkoutWA)" class="bg-green-600 text-white px-3 py-1 rounded w-full mt-2">Checkout</button>
  <button onclick="tutupKeranjang()" class="bg-gray-400 px-3 py-1 rounded w-full mt-2">Kembali</button>
</div>

<!-- Popup Sign In -->
<div id="popupSignIn" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-4 rounded-lg w-80">
    <h2 class="font-bold mb-2">Sign In</h2>
    <input id="inputUser" placeholder="Nomor WA / Username" class="border w-full mb-2 p-2 rounded">
    <input id="inputPIN" type="password" placeholder="PIN" class="border w-full mb-2 p-2 rounded">
    <div class="flex justify-between">
      <button onclick="login()" class="bg-green-500 text-white px-3 py-1 rounded">Login</button>
      <button onclick="closeSignIn()" class="bg-gray-400 px-3 py-1 rounded">Batal</button>
    </div>
  </div>
</div>

<script>
let barangList = JSON.parse(localStorage.getItem('barangList')) || [];
let cartList = JSON.parse(localStorage.getItem('cartList')) || [];
let selectedBarang = null;
let loggedIn = JSON.parse(localStorage.getItem('loggedIn')) || false;

// Render kategori dan barang
function renderKategori(){
  const container=document.getElementById('kategoriList'); container.innerHTML='';
  const kategoriUnik=[...new Set(barangList.map(b=>b.kategori))];
  kategoriUnik.forEach(kat=>{
    const div=document.createElement('div'); div.className='border rounded-lg';
    const header=document.createElement('div');
    header.className='bg-red-100 px-4 py-2 font-bold cursor-pointer';
    header.innerText=kat; header.onclick=()=>toggleKategori(kat);
    div.appendChild(header);
    const list=document.createElement('div'); list.id='list-'+kat; list.className='hidden p-2 space-y-2';
    barangList.filter(b=>b.kategori===kat).forEach(b=>{
      const item=document.createElement('div'); item.className='flex items-center justify-between border p-2 rounded';
      item.onclick=()=>bukaPopup(b);
      const kiri=document.createElement('div'); kiri.className='flex items-center gap-2';
      const img=document.createElement('img'); img.src=b.gambar; img.className='w-10 h-10 object-cover rounded';
      kiri.appendChild(img); const nama=document.createElement('span'); nama.innerText=`${b.nama} [${b.stok}]`; kiri.appendChild(nama);
      item.appendChild(kiri); list.appendChild(item);
    });
    div.appendChild(list); container.appendChild(div);
  });
}
function toggleKategori(kat){document.getElementById('list-'+kat).classList.toggle('hidden')}
function showAddForm(){document.getElementById('formTambah').classList.remove('hidden')}
function tutupForm(){document.getElementById('formTambah').classList.add('hidden')}
function simpanBarang(){
  const nama=document.getElementById('namaBarang').value;
  const kategori=document.getElementById('kategoriBarang').value;
  const stok=parseInt(document.getElementById('stokBarang').value)||0;
  const file=document.getElementById('gambarBarang').files[0];
  if(!nama||!kategori)return alert('Lengkapi data!');
  const reader=new FileReader();
  reader.onload=e=>{
    barangList.push({nama,kategori,stok,gambar:e.target.result});
    localStorage.setItem('barangList',JSON.stringify(barangList)); renderKategori(); tutupForm();
  };
  if(file)reader.readAsDataURL(file); else { barangList.push({nama,kategori,stok,gambar:''}); localStorage.setItem('barangList',JSON.stringify(barangList)); renderKategori(); tutupForm(); }
}

// Popup Barang
function bukaPopup(barang){
  selectedBarang=barang;
  document.getElementById('popupNama').innerText=barang.nama;
  document.getElementById('popupStok').innerText=`Stok: ${barang.stok}`;
  document.getElementById('popupGambar').src=barang.gambar;
  document.getElementById('popupAksi').classList.remove('hidden');
}
function tutupPopup(){document.getElementById('popupAksi').classList.add('hidden')}
function barangMasuk(){selectedBarang.stok++;updateBarang()}
function barangKeluar(){if(selectedBarang.stok>0)selectedBarang.stok--;updateBarang()}
function editBarang(){
  const namaBaru=prompt('Nama baru:',selectedBarang.nama);
  if(namaBaru)selectedBarang.nama=namaBaru;
  const stokBaru=prompt('Stok baru:',selectedBarang.stok);
  if(stokBaru!==null)selectedBarang.stok=parseInt(stokBaru);
  updateBarang();
}
function hapusBarang(){if(confirm('Hapus barang ini?')){barangList=barangList.filter(b=>b!==selectedBarang); localStorage.setItem('barangList',JSON.stringify(barangList)); renderKategori(); tutupPopup();}}
function updateBarang(){localStorage.setItem('barangList',JSON.stringify(barangList)); renderKategori(); tutupPopup();}

// Barang Kosong
function showKosong(){document.getElementById('halamanKosong').classList.remove('hidden'); document.getElementById('kategoriList').classList.add('hidden'); const listKosong=document.getElementById('listKosong'); listKosong.innerHTML=''; barangList.filter(b=>b.stok===0).forEach(b=>{const li=document.createElement('li'); li.className='flex justify-between items-center border p-2 rounded'; li.innerText=b.nama; listKosong.appendChild(li);});}
function tutupKosong(){document.getElementById('halamanKosong').classList.add('hidden'); document.getElementById('kategoriList').classList.remove('hidden')}

// Keranjang
function addToCart(satuan){
  if(!selectedBarang) return;
  const existing=cartList.find(i=>i.nama===selectedBarang.nama && i.satuan===satuan);
  if(existing) existing.jumlah++; else cartList.push({nama:selectedBarang.nama,jumlah:1,satuan});
  localStorage.setItem('cartList',JSON.stringify(cartList));
  alert("Ditambahkan ke keranjang"); tutupPopup();
}
function showKeranjang(){document.getElementById('halamanKeranjang').classList.remove('hidden'); document.getElementById('kategoriList').classList.add('hidden'); renderKeranjang();}
function tutupKeranjang(){document.getElementById('halamanKeranjang').classList.add('hidden'); document.getElementById('kategoriList').classList.remove('hidden')}
function renderKeranjang(){const ul=document.getElementById('listKeranjang'); ul.innerHTML=''; cartList.forEach((i,idx)=>{const li=document.createElement('li'); li.className='flex justify-between items-center border p-2 rounded'; li.innerHTML=`${i.nama} x${i.jumlah} ${i.satuan}<div class="flex gap-1"><button onclick="ubahJumlah(${idx},1)" class="bg-green-500 text-white px-2">+</button><button onclick="ubahJumlah(${idx},-1)" class="bg-yellow-500 text-white px-2">-</button><button onclick="hapusCart(${idx})" class="bg-red-600 text-white px-2">Hapus</button></div>`; ul.appendChild(li);});}
function ubahJumlah(idx,delta){cartList[idx].jumlah+=delta;if(cartList[idx].jumlah<=0)cartList.splice(idx,1);localStorage.setItem('cartList',JSON.stringify(cartList));renderKeranjang();}
function hapusCart(idx){cartList.splice(idx,1);localStorage.setItem('cartList',JSON.stringify(cartList));renderKeranjang();}
function checkoutWA(){
  if(cartList.length===0)return alert("Keranjang kosong!");
  let pesan="*Order Baru:*\n\n";
  cartList.forEach(i=>pesan+=`- ${i.nama} x${i.jumlah} ${i.satuan}\n`);
  pesan+="\nTerima kasih ðŸ™";
  const url=`https://wa.me/?text=${encodeURIComponent(pesan)}`;
  window.open(url,'_blank');
}

// Login
function showSignIn(){document.getElementById('popupSignIn').classList.remove('hidden')}
function closeSignIn(){document.getElementById('popupSignIn').classList.add('hidden')}
function login(){const user=document.getElementById('inputUser').value.trim(); const pin=document.getElementById('inputPIN').value.trim(); if(user&&pin){loggedIn=true; localStorage.setItem('loggedIn',JSON.stringify(loggedIn)); alert("Login berhasil!"); closeSignIn(); updateLoginUI();} else alert("Masukkan user & PIN!");}
function checkLogin(func){if(!loggedIn){alert("Silakan login dulu"); return;} func();}
function updateLoginUI(){document.getElementById('btnSignIn').innerText="Logout";document.getElementById('btnSignIn').onclick=()=>{loggedIn=false; localStorage.setItem('loggedIn',JSON.stringify(loggedIn)); alert("Logout berhasil"); document.getElementById('btnSignIn').innerText="Sign In"; document.getElementById('btnSignIn').onclick=showSignIn;}}

updateLoginUI();
renderKategori();
</script>
</body>
</html>

