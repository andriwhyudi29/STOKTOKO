<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>STOKTOKO</title>
  <!--
    STOKTOKO - versi tanpa harga (sesuai kode asli)
    Fungsional: tambah produk, kategori collapsible, modal aksi (EDIT/STOK/HAPUS + pilih unit pcs/bal/dus),
    cart/keranjang dengan qty +/- dan pilih unit, pilih item sebelum checkout, barang kosong, 
    navigasi antar halaman, serta penyimpanan localStorage (persisten di browser).
    Catatan: Tidak ada field harga sama sekali. Ukuran file ini sengaja > 12KB.
  -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --merah:#e40000;
      --merah-tua:#b00000;
      --bg:#fafafa;
      --card:#ffffff;
      --text:#222;
      --sub:#777;
      --line:#eee;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    /* Header */
    header{
      position:sticky; top:0; z-index:1000;
      background:linear-gradient(90deg,var(--merah),var(--merah-tua));
      color:#fff; display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px; box-shadow:0 2px 8px rgba(0,0,0,.18);
      font-weight:600; letter-spacing:.3px;
    }
    .brand{font-size:18px}
    .cart-btn{
      display:flex; align-items:center; gap:8px;
      background:#fff; color:var(--merah); border:none; border-radius:12px; padding:6px 10px;
      font-weight:600; box-shadow:0 2px 8px rgba(0,0,0,.12); cursor:pointer;
    }
    .page{padding:16px; max-width:820px; margin:0 auto;}
    /* Tombol besar */
    .cta{ display:flex; gap:12px; margin-bottom:16px; }
    .btn{
      flex:1; display:flex; align-items:center; justify-content:center; gap:8px;
      padding:14px 16px; border-radius:14px; border:none; cursor:pointer; font-weight:600;
      transition:.2s transform,.2s box-shadow; box-shadow:0 4px 12px rgba(0,0,0,.08);
    }
    .btn:active{transform:scale(.97)}
    .btn-primary{background:var(--merah); color:#fff}
    .btn-outline{background:#fff; color:var(--merah); border:2px solid var(--merah)}
    /* Form tambah */
    form{
      display:none; background:var(--card); border-radius:14px; padding:14px;
      box-shadow:0 6px 16px rgba(0,0,0,.08); margin-bottom:16px;
    }
    label{font-size:12px; color:var(--sub)}
    input[type="text"], input[type="number"], input[type="file"], button[type="submit"]{
      width:100%; padding:12px; border-radius:10px; border:1px solid var(--line); margin:6px 0 12px 0;
      font-size:14px; background:#fff;
    }
    button[type="submit"]{background:var(--merah); color:#fff; border:none; font-weight:600}
    /* Kategori */
    .category{margin:14px 0}
    .category h3{
      margin:0; background:#ffe9e9; color:var(--merah-tua);
      padding:10px 12px; border-radius:10px; cursor:pointer; font-size:14px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .products{display:none; padding:8px 4px}
    .product{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:var(--card); border-radius:12px; padding:10px; margin:8px 0;
      box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    .p-left{display:flex; align-items:center; gap:10px}
    .product img{
      width:54px; height:54px; object-fit:cover; border-radius:8px; border:1px solid var(--line);
    }
    .p-name{font-weight:600; font-size:14px}
    .p-sub{font-size:12px; color:var(--sub)}
    .plus-btn{
      background:#fff; color:var(--merah); border:2px solid var(--merah);
      width:42px; height:36px; border-radius:10px; font-size:20px; font-weight:700; cursor:pointer;
    }
    /* Halaman kosong */
    #emptyPage h2{color:var(--merah); margin:0 0 10px}
    .back-btn{
      display:inline-block; background:var(--merah); color:#fff; border:none;
      padding:8px 12px; border-radius:10px; margin-bottom:10px; cursor:pointer; font-weight:600;
    }
    .empty-item{
      display:flex; align-items:center; gap:10px; background:#fff; border-radius:12px;
      padding:10px; margin:8px 0; box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    .empty-item img{width:50px; height:50px; object-fit:cover; border-radius:8px; border:1px solid var(--line)}
    /* Keranjang */
    #cartPage header{position:static}
    .cart-item{
      display:flex; align-items:center; gap:10px; background:#fff; border-radius:12px; padding:10px;
      margin:8px 0; box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    .cart-item img{width:60px; height:60px; border-radius:8px; object-fit:cover; border:1px solid var(--line)}
    .item-body{flex:1}
    .item-name{font-size:14px; font-weight:600}
    .unit-row{display:flex; align-items:center; gap:8px; margin-top:6px}
    .unit-select{
      font-size:12px; padding:4px 6px; border:1px solid var(--line); border-radius:6px; background:#fff;
    }
    .qty{display:flex; align-items:center; gap:8px}
    .qty button{
      width:28px; height:28px; border:none; background:#f1f1f1; border-radius:8px; font-size:18px; cursor:pointer;
    }
    .qty span{min-width:18px; text-align:center}
    .cart-footer{
      position:sticky; bottom:0; left:0; right:0; background:#fff; border-top:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 12px;
      box-shadow:0 -4px 12px rgba(0,0,0,.06);
    }
    .checkout-btn{
      background:var(--merah); color:#fff; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer;
    }
    /* Bottom sheet modal (aksi produk) */
    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; z-index:1200; }
    .overlay.active{display:block}
    .modal{
      position:fixed; left:0; right:0; bottom:-100%;
      background:#fff; border-radius:16px 16px 0 0; padding:18px; z-index:1300;
      box-shadow:0 -10px 24px rgba(0,0,0,.2); transition:bottom .28s ease-out;
    }
    .modal.active{bottom:0}
    .modal h3{margin:0 0 12px; text-align:center}
    .modal-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    .modal-grid button{
      padding:14px 10px; border:none; border-radius:12px; font-weight:700; cursor:pointer;
      background:#ffe9e9; color:var(--merah-tua);
    }
    /* Halaman switching */
    .hidden{display:none}
  </style>
</head>
<body>  <!-- Header global -->  <header>
    <div class="brand">STOKTOKO</div>
    <button class="cart-btn" id="openCartBtn"> <span id="cartCount">0</span></button>
  </header>  <!-- PAGE: MAIN -->  <section id="mainPage" class="page">
    <div class="cta">
      <button class="btn btn-primary" id="toggleFormBtn"> Tambahkan Produk</button>
      <button class="btn btn-outline" id="goEmptyBtn"> Barang Kosong</button>
    </div><form id="productForm">
  <label>Nama Produk</label>
  <input type="text" id="nama" placeholder="cth: Indomie Goreng" required>
  <label>Kategori</label>
  <input type="text" id="kategori" placeholder="cth: Mie Instan" required>
  <label>Sisa Stok</label>
  <input type="number" id="stok" min="0" value="0" required>
  <label>Gambar Produk (maks 6 MB)</label>
  <input type="file" id="gambar" accept="image/*" required>
  <button type="submit">Simpan Produk</button>
</form>

<div id="categories"></div>

  </section>  <!-- PAGE: BARANG KOSONG -->  <section id="emptyPage" class="page hidden">
    <button class="back-btn" id="backMainBtn"> Kembali</button>
    <h2>Barang Kosong</h2>
    <div id="emptyList"></div>
  </section>  <!-- PAGE: CART -->  <section id="cartPage" class="page hidden">
    <button class="back-btn" id="backFromCartBtn"> Kembali</button>
    <h2 style="margin:8px 0 12px;color:var(--merah)">Keranjang</h2>
    <div id="cartList"></div>
    <div class="cart-footer">
      <div id="cartTotal">Total: 0 barang</div>
      <button class="checkout-btn" id="checkoutBtn">Checkout</button>
    </div>
  </section>  <!-- Modal aksi produk -->  <div class="overlay" id="overlay"></div>
  <div class="modal" id="modal">
    <h3>Aksi Produk</h3>
    <div class="modal-grid">
      <button id="mEdit">EDIT</button>
      <button id="mStok">STOK</button>
      <button id="mHapus">HAPUS</button>
      <button data-unit="pcs" class="mUnit">PCS</button>
      <button data-unit="bal" class="mUnit">BAL</button>
      <button data-unit="dus" class="mUnit">DUS</button>
    </div>
  </div><script>
  // ====== STATE ======
  let categories = {}; // {kategori: [{id,nama,kategori,stok,imageUrl}]}
  let cart = [];       // [{prodId, nama, unit, qty, imageUrl}]
  let selectedProductId = null; // buat modal aksi
  const $ = (s, p=document) => p.querySelector(s);
  const $$ = (s, p=document) => [...p.querySelectorAll(s)];

  // ====== PERSISTENCE (LOCAL STORAGE) ======
  const STORAGE_KEY = 'STOKTOKO_DATA_V1';
  function saveData(){
    try{
      const payload = { categories, cart };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    }catch(e){ console.warn('Gagal menyimpan data:', e); }
  }
  function loadData(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      const obj = JSON.parse(raw);
      if(obj && typeof obj === 'object'){
        categories = obj.categories || {};
        cart = obj.cart || [];
      }
    }catch(e){ console.warn('Gagal memuat data:', e); }
  }

  // ====== NAV / PAGE SWITCH ======
  const mainPage = $('#mainPage');
  const emptyPage = $('#emptyPage');
  const cartPage = $('#cartPage');

  $('#goEmptyBtn').onclick = () => { mainPage.classList.add('hidden'); emptyPage.classList.remove('hidden'); renderEmpty(); };
  $('#backMainBtn').onclick = () => { emptyPage.classList.add('hidden'); mainPage.classList.remove('hidden'); };
  $('#openCartBtn').onclick   = () => { mainPage.classList.add('hidden'); emptyPage.classList.add('hidden'); cartPage.classList.remove('hidden'); renderCart(); };
  $('#backFromCartBtn').onclick = () => { cartPage.classList.add('hidden'); mainPage.classList.remove('hidden'); };

  // ====== FORM TAMBAH PRODUK ======
  const form = $('#productForm');
  $('#toggleFormBtn').onclick = () => form.style.display = (form.style.display==='block'?'none':'block');

  form.onsubmit = (e) => {
    e.preventDefault();
    const nama = $('#nama').value.trim();
    const kategori = $('#kategori').value.trim();
    const stok = parseInt($('#stok').value||'0');
    const file = $('#gambar').files[0];
    if (!file){ alert('Pilih gambar'); return; }
    if (file.size > 6 * 1024 * 1024){ alert('Ukuran gambar maksimal 6 MB!'); return; }

    const reader = new FileReader();
    reader.onload = ev => {
      const imageUrl = ev.target.result;
      const id = Date.now().toString(36)+Math.random().toString(36).slice(2,7);
      const product = { id, nama, kategori, stok, imageUrl };
      if(!categories[kategori]) categories[kategori] = [];
      categories[kategori].push(product);
      renderCategories();
      form.reset(); form.style.display='none';
      saveData();
    };
    reader.readAsDataURL(file);
  };

  // ====== RENDER KATEGORI & PRODUK ======
  function renderCategories(){
    const wrap = $('#categories');
    wrap.innerHTML = '';
    Object.keys(categories).forEach(cat=>{
      const catDiv = document.createElement('div');
      catDiv.className = 'category';
      const h = document.createElement('h3');
      h.innerHTML = `${cat} <span>(${categories[cat].length})</span>`;
      h.onclick = () => {
        const pd = catDiv.querySelector('.products');
        pd.style.display = (pd.style.display==='block'?'none':'block');
      };
      const productsDiv = document.createElement('div');
      productsDiv.className = 'products';

      categories[cat].forEach(p=>{
        const row = document.createElement('div');
        row.className = 'product';
        row.innerHTML = `
          <div class="p-left">
            <img src="${p.imageUrl}" alt="">
            <div>
              <div class="p-name">${p.nama}</div>
              <div class="p-sub">stok: ${p.stok}</div>
            </div>
          </div>
          <button class="plus-btn" aria-label="aksi" data-id="${p.id}">+</button>
        `;
        productsDiv.appendChild(row);
      });

      catDiv.appendChild(h); catDiv.appendChild(productsDiv);
      wrap.appendChild(catDiv);
    });

    // bind tombol +
    $$('.plus-btn', wrap).forEach(btn=>{
      btn.onclick = () => openModal(btn.dataset.id);
    });
  }

  // ====== BARANG KOSONG ======
  function collectEmpty(){
    const arr = [];
    Object.values(categories).forEach(list=>{
      list.forEach(p=>{ if(p.stok===0) arr.push(p); });
    });
    return arr;
  }
  function renderEmpty(){
    const list = $('#emptyList');
    list.innerHTML = '';
    collectEmpty().forEach(p=>{
      const div = document.createElement('div');
      div.className = 'empty-item';
      div.innerHTML = `
        <img src="${p.imageUrl}" alt="">
        <div>
          <div class="p-name">${p.nama}</div>
          <div class="p-sub">stok: 0</div>
          <div class="p-sub">Kategori: ${p.kategori}</div>
        </div>
      `;
      list.appendChild(div);
    });
  }

  // ====== MODAL AKSI PRODUK ======
  const overlay = $('#overlay'), modal = $('#modal');
  function openModal(prodId){
    selectedProductId = prodId;
    overlay.classList.add('active'); modal.classList.add('active');
  }
  function closeModal(){
    overlay.classList.remove('active'); modal.classList.remove('active');
  }
  overlay.onclick = closeModal;

  function findProductById(id){
    for(const cat of Object.keys(categories)){
      const idx = categories[cat].findIndex(p=>p.id===id);
      if(idx>-1) return { cat, index:idx, p:categories[cat][idx] };
    }
    return null;
  }

  // EDIT (nama, kategori, gambar)
  $('#mEdit').onclick = ()=>{
    const ref = findProductById(selectedProductId); if(!ref) return;
    const {cat, index, p} = ref;
    const newName = prompt('Nama baru:', p.nama); if(!newName){ closeModal(); return; }
    const newCat = prompt('Kategori baru:', p.kategori) || p.kategori;

    const afterUpdate = ()=>{
      // pindah kategori bila berubah
      if(newCat !== p.kategori){
        categories[cat].splice(index,1);
        if(!categories[newCat]) categories[newCat]=[];
        p.kategori = newCat;
        categories[newCat].push(p);
      }
      p.nama = newName;
      renderCategories(); renderEmpty(); closeModal(); saveData();
    };

    if(confirm('Ganti gambar juga?')){
      const input = document.createElement('input');
      input.type='file'; input.accept='image/*';
      input.onchange = e=>{
        const file = e.target.files[0];
        if(!file){ afterUpdate(); return; }
        if(file.size > 6*1024*1024){ alert('Ukuran gambar maksimal 6 MB!'); return; }
        const r = new FileReader();
        r.onload = ev => { p.imageUrl = ev.target.result; afterUpdate(); };
        r.readAsDataURL(file);
      };
      input.click();
    }else{
      afterUpdate();
    }
  };

  // STOK
  $('#mStok').onclick = ()=>{
    const ref = findProductById(selectedProductId); if(!ref) return;
    const {p} = ref;
    const val = prompt('Stok baru:', p.stok);
    if(val===null) { closeModal(); return; }
    p.stok = parseInt(val||'0');
    renderCategories(); renderEmpty(); closeModal(); saveData();
  };

  // HAPUS
  $('#mHapus').onclick = ()=>{
    const ref = findProductById(selectedProductId); if(!ref) return;
    const {cat, index, p} = ref;
    if(!confirm('Hapus produk ini?')) return;
    categories[cat].splice(index,1);
    if(categories[cat].length===0) delete categories[cat];
    // bersihkan dari cart juga
    cart = cart.filter(c=>c.prodId!==p.id);
    updateCartCount();
    renderCategories(); renderEmpty(); if(!$('#cartPage').classList.contains('hidden')) renderCart();
    closeModal(); saveData();
  };

  // Tambah ke keranjang (PCS/BAL/DUS)
  $$('.mUnit').forEach(b=>{
    b.onclick = ()=> {
      const unit = b.dataset.unit;
      const ref = findProductById(selectedProductId); if(!ref) return;
      const {p} = ref;
      const exist = cart.find(c=>c.prodId===p.id && c.unit===unit);
      if(exist) exist.qty += 1; else cart.push({ prodId:p.id, nama:p.nama, unit, qty:1, imageUrl:p.imageUrl });
      updateCartCount();
      closeModal(); saveData();
    }
  });

  function updateCartCount(){
    const total = cart.reduce((a,c)=>a+c.qty,0);
    $('#cartCount').textContent = total;
  }

  // ====== CART RENDER ======
  function renderCart(){
    const list = $('#cartList');
    list.innerHTML = '';
    cart.forEach((item)=>{
      const row = document.createElement('div');
      row.className = 'cart-item';
      row.innerHTML = `
        <input type="checkbox" class="chk">
        <img src="${item.imageUrl}" alt="">
        <div class="item-body">
          <div class="item-name">${item.nama}</div>
          <div class="unit-row">
            <select class="unit-select">
              <option ${item.unit==='pcs'?'selected':''}>pcs</option>
              <option ${item.unit==='bal'?'selected':''}>bal</option>
              <option ${item.unit==='dus'?'selected':''}>dus</option>
            </select>
            <div class="qty">
              <button class="minus">-</button>
              <span class="q">${item.qty}</span>
              <button class="plus">+</button>
            </div>
          </div>
        </div>
      `;
      // Bind events
      const unitSel = $('.unit-select', row);
      unitSel.onchange = ()=>{ item.unit = unitSel.value; saveData(); };
      const minus = $('.minus', row);
      const plus = $('.plus', row);
      const qSpan = $('.q', row);
      const chk = $('.chk', row);

      minus.onclick = ()=>{ if(item.qty>1){ item.qty--; qSpan.textContent=item.qty; updateCartCount(); updateCartTotal(); saveData(); } };
      plus.onclick  = ()=>{ item.qty++; qSpan.textContent=item.qty; updateCartCount(); updateCartTotal(); saveData(); };
      chk.onchange  = updateCartTotal;

      list.appendChild(row);
    });
    updateCartTotal();
  }

  function updateCartTotal(){
    const rows = $$('#cartList .cart-item');
    let total = 0;
    rows.forEach((row)=>{
      const chk = $('.chk', row);
      if(chk.checked){
        const q = parseInt($('.q', row).textContent||'0');
        total += q;
      }
    });
    $('#cartTotal').textContent = `Total: ${total} barang`;
  }

  // ====== CHECKOUT -> WHATSAPP ======
  $('#checkoutBtn').onclick = ()=>{
    const rows = $$('#cartList .cart-item');
    let items = [];

    rows.forEach((row)=>{
      const chk = $('.chk', row);
      if(chk.checked){
        const name = $('.item-name', row).textContent.trim();
        const unit = $('.unit-select', row).value;
        const qty  = parseInt($('.q', row).textContent||'0');
        items.push({name, qty, unit});
      }
    });

    if(items.length===0){ alert('Pilih dulu item yang mau di-checkout.'); return; }

    // cukup 1 titik setelah nama
    let lines = items.map(i=>`- ${i.name}. ${i.qty} ${i.unit}`);

    const msg  = "Order :\n" + lines.join("\n");
    const url  = `https://wa.me/?text=${encodeURIComponent(msg)}`;
    window.open(url, '_blank');
  };

  // ====== INIT LOAD ======
  loadData();
  renderCategories();
  updateCartCount();
  // renderEmpty() akan dipanggil saat masuk halaman Barang Kosong

  // ====== SEED (opsional, dibiarkan kosong default) ======
  // (contoh cepat jika mau ngetes: hapus komentar di bawah)
  /*
  if(Object.keys(categories).length===0){
    const img='https://via.placeholder.com/100';
    categories['Minuman']=[{id:'a1',nama:'Aqua Botol',kategori:'Minuman',stok:10,imageUrl:img}];
    categories['Mie Instan']=[{id:'b2',nama:'Indomie Goreng',kategori:'Mie Instan',stok:0,imageUrl:img}];
    renderCategories(); saveData();
  }
  */
</script></body>
</html>